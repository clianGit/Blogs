---
layout: post
title:  "JNI - Java Native Interface"
author: chenlian
categories: Java
tags: Java
excerpt: Java Native Interface (JNI) is a standard programming interface for writing Java native methods and embedding the Java virtual machine into native applications. The primary goal is binary compatibility of native method libraries across all Java virtual mechine implementations on a given platform.
---


* content
{:toc}
Java Native Interface (JNI) is a standard programming interface for writing Java native methods and embedding the Java virtual machine into native applications. The primary goal is binary compatibility of native method libraries across all Java virtual mechine implementations on a given platform.



## 简介


Java 通过 JNI 来处理 Java 不能好来处理的问题，也允许 Java 调用改造好的其他的语言的程序。


JNI 带来的影响：


*  程序不再跨平台。要实现跨平台，需要在不同平台上实现的native methods 。
*  程序不再绝对安全。


## JNI 编程


Java 数据类型和 JNI 数据类型之间的对应关系：


Primitive Types


```
Java Type				Native Type			Description

boolean					jboolean			unsigned 8 bits
byte					jbyte				signed 8 bits
char					jchar				unsigned 16 bits
short					jshort				signed 16 bits
int					jint				signed 32 bits
long					jlong				signed 64 bits
float					jfloat				32 bits
double					jdouble				64 bits
void					void				not applicable

```


Reference Types


```
Java Type					Native Type

java.lang.Class object				jclass
java.lang.String object				jstring
ojbect arrays					jobjectArray
boolean arrays					jbooleanArray
byte arrays					jbyteArray
char arrays					jcharArray
short arrays					jshortArray
int arrays					jintArray
long arrays					jlongArray
float arrays					jfloatArray
jdoubleArray					double arrays

```


Type Signatures


```
			Java VM Type Signatures
Type Signature				Java Type
Z					boolean
B					byte
C					char
I					int
J					long
F					float
D					double
L full-qualified-class;			full-qualified-class
[ type					type[]
(arg-types) ret-type			method type

```


### 编写带有native 申明的方法的Java 类

```java
public class HelloWorld{
    static{
        System.loadLibrary("Hello");
    }

    public native void DisplayHello(String str);

    public static void main(String[] args){
        String str = new String("java");
        new HelloWorld().DisplayHello(str);
    }
}

```


### 编译Java 类和产生JNI 头文件


> javac HelloWorld.java


> javah HelloWrold


HelloWorld.h 的内容


```c++
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloWorld */

#ifndef _Included_HelloWorld
#define _Included_HelloWorld
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloWorld
 * Method:    DisplayHello
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_HelloWorld_DisplayHello
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif

```


## 编写自定义的 Native function


编写的自定义的文件中需要包含进 jni.h 和 编译产生的HelloWrold.h 头文件，并实现HelloWorld.h 中声明的Native function。


```c++
#include"HelloWorld.h"
#include<iostream>
#include<jni.h>

JNIEXPORT void JNICALL Java_HelloWorld_DisplayHello
(JNIEnv * env,jobject obj,jstring str)
{
    const char * mystr = env->GetStringUTFChars(str,0);
    std::cout<<"hello world from C++,the string is "<<mystr<<std::endl;
}

```


将自定义的 Native function 编译为动态库，供 Java 调用。


> g++ -shared -fPIC -I /usr/java/jdk1.8.0_121/include/linux/ -I /usr/java/jdk1.8.0_121/include/ -o libHello.so Hello.cc


### 运行Java 程序


> java -Djava.library.path=. HelloWorld
